{% extends 'nemo_park/base.html' %}

{% block title %}–†–∞—Å—á—ë—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-title">üßÆ –†–∞—Å—á—ë—Ç –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã</div>
</div>

<!-- –§–æ—Ä–º–∞ —Ä–∞—Å—á—ë—Ç–∞ -->
<div class="form-container-wide">
    <div class="form-card">
        <form method="post">
            {% csrf_token %}
            <div class="form-grid">
                <div>
                    <label>üë§ –°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
                    {{ form.employee }}
                </div>
                <div>
                    <label>üìÖ –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞</label>
                    {{ form.period_start }}
                </div>
                <div>
                    <label>üìÖ –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞</label>
                    {{ form.period_end }}
                </div>
                <div>
                    <label>&nbsp;</label>
                    <button type="submit" name="preview" class="btn btn-warning" style="width: 100%;">
                        üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞ -->
{% if preview %}
<div class="result-card">
    <div class="result-card-header">
        <h3 style="margin: 0;">üìã –†–∞—Å—á—ë—Ç–Ω—ã–π –ª–∏—Å—Ç</h3>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">
            {{ preview.employee.full_name }} | {{ preview.period_start|date:"d.m.Y" }} ‚Äî {{ preview.period_end|date:"d.m.Y" }}
        </p>
    </div>
    
    <div class="result-card-body">
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">üíº –î–æ–ª–∂–Ω–æ—Å—Ç—å</td>
                <td style="padding: 12px 0; text-align: right;">
                    <span class="badge badge-{{ preview.employee.position }}">{{ preview.employee.get_position_display }}</span>
                </td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">üïê –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã</td>
                <td style="padding: 12px 0; text-align: right;">
                    {{ preview.employee.work_start|time:"H:i" }} ‚Äî {{ preview.employee.work_end|time:"H:i" }}
                </td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">üìÖ –†–∞–±–æ—á–∏–µ –¥–Ω–∏</td>
                <td style="padding: 12px 0; text-align: right;">{{ preview.employee.work_days_display }}</td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">üíµ –°—Ç–∞–≤–∫–∞ –≤ —á–∞—Å</td>
                <td style="padding: 12px 0; text-align: right;"><strong>{{ preview.hourly_rate }} ‚ÇΩ/—á–∞—Å</strong></td>
            </tr>
            <tr style="border-bottom: 2px solid #0077B6; background: #f8fafc;">
                <td style="padding: 12px 0; font-weight: 600;">üìÜ –†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –≤ –ø–µ—Ä–∏–æ–¥–µ</td>
                <td style="padding: 12px 0; text-align: right;"><strong>{{ preview.work_days }} –¥–Ω.</strong></td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">‚è±Ô∏è –ß–∞—Å–æ–≤ –≤ –¥–µ–Ω—å</td>
                <td style="padding: 12px 0; text-align: right;">{{ preview.hours_per_day|floatformat:1 }}—á</td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">‚è±Ô∏è –í—Å–µ–≥–æ —á–∞—Å–æ–≤</td>
                <td style="padding: 12px 0; text-align: right;"><strong>{{ preview.total_hours|floatformat:1 }}—á</strong></td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">üî• –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</td>
                <td style="padding: 12px 0; text-align: right;">{{ preview.overtime_hours|floatformat:1 }}—á</td>
            </tr>
            <tr style="border-bottom: 2px solid #0077B6; background: #f8fafc;">
                <td style="padding: 12px 0; font-weight: 600;">üí∞ –ë–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞</td>
                <td style="padding: 12px 0; text-align: right;">{{ preview.base_salary|floatformat:0 }} ‚ÇΩ</td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">üî• –ó–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫—É (x1.5)</td>
                <td style="padding: 12px 0; text-align: right;">{{ preview.overtime_pay|floatformat:0 }} ‚ÇΩ</td>
            </tr>
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 12px 0;">üéÅ –ü—Ä–µ–º–∏—è</td>
                <td style="padding: 12px 0; text-align: right;">{{ preview.bonus|floatformat:0 }} ‚ÇΩ</td>
            </tr>
            <tr style="border-bottom: 2px solid #00b894; background: #e8f5e9;">
                <td style="padding: 12px 0; font-weight: 600;">üìä –ò–¢–û–ì–û –Ω–∞—á–∏—Å–ª–µ–Ω–æ</td>
                <td style="padding: 12px 0; text-align: right; font-weight: 700;">{{ preview.gross_salary|floatformat:0 }} ‚ÇΩ</td>
            </tr>
            <tr style="border-bottom: 1px solid #eee; background: #fff3e0;">
                <td style="padding: 12px 0; color: #e74c3c;">üìâ –ù–î–§–õ (13%)</td>
                <td style="padding: 12px 0; text-align: right; color: #e74c3c;">-{{ preview.ndfl_tax|floatformat:0 }} ‚ÇΩ</td>
            </tr>
            <tr style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: white;">
                <td style="padding: 15px; font-size: 1.2rem; font-weight: 700;">üíµ –ö –í–´–ü–õ–ê–¢–ï</td>
                <td style="padding: 15px; text-align: right; font-size: 1.5rem; font-weight: 800;">{{ preview.net_salary|floatformat:0 }} ‚ÇΩ</td>
            </tr>
        </table>
        
        <form method="post" style="margin-top: 25px;">
            {% csrf_token %}
            <input type="hidden" name="employee" value="{{ preview.employee.id }}">
            <input type="hidden" name="period_start" value="{{ preview.period_start|date:'Y-m-d' }}">
            <input type="hidden" name="period_end" value="{{ preview.period_end|date:'Y-m-d' }}">
            <button type="submit" name="create" class="btn btn-success" style="width: 100%; padding: 15px; font-size: 1.1rem;">
                ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—á—ë—Ç–Ω—ã–π –ª–∏—Å—Ç
            </button>
        </form>
    </div>
</div>
{% endif %}

<div class="buttons-center" style="margin-top: 25px;">
    <a href="{% url 'payroll_list' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
</div>
{% endblock %}