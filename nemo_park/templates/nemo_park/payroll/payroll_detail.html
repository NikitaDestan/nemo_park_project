{% extends 'nemo_park/base.html' %}

{% block title %}–†–∞—Å—á—ë—Ç–Ω—ã–π –ª–∏—Å—Ç{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-title">üìã –†–∞—Å—á—ë—Ç–Ω—ã–π –ª–∏—Å—Ç #{{ payroll.pk }}</div>
</div>

<div class="cards-grid">
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ -->
    <div class="info-card">
        <div class="info-card-header blue">
            <h3 style="margin: 0;">üë§ {{ payroll.employee.full_name }}</h3>
            <p style="margin: 5px 0 0 0; opacity: 0.9;">{{ payroll.employee.get_position_display }}</p>
        </div>
        <div class="info-card-body">
            <p><strong>üìÖ –ü–µ—Ä–∏–æ–¥:</strong> {{ payroll.period_start|date:"d.m.Y" }} ‚Äî {{ payroll.period_end|date:"d.m.Y" }}</p>
            <p><strong>üïê –ì—Ä–∞—Ñ–∏–∫:</strong> {{ payroll.employee.work_start|time:"H:i" }} - {{ payroll.employee.work_end|time:"H:i" }}</p>
            <p><strong>üìÜ –†–∞–±–æ—á–∏–µ –¥–Ω–∏:</strong> {{ payroll.employee.work_days_display }}</p>
            <p><strong>üíµ –°—Ç–∞–≤–∫–∞:</strong> {{ payroll.employee.hourly_rate }} ‚ÇΩ/—á–∞—Å</p>
            <p><strong>üìä –°—Ç–∞—Ç—É—Å:</strong> 
                {% if payroll.status == 'paid' %}
                    <span class="badge" style="background: #00b894; color: white;">‚úÖ –í—ã–ø–ª–∞—á–µ–Ω–æ</span>
                {% elif payroll.status == 'confirmed' %}
                    <span class="badge" style="background: #0077B6; color: white;">üìã –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω</span>
                {% else %}
                    <span class="badge" style="background: #f39c12; color: white;">‚è≥ –ß–µ—Ä–Ω–æ–≤–∏–∫</span>
                {% endif %}
            </p>
            {% if payroll.paid_at %}
            <p><strong>üí≥ –î–∞—Ç–∞ –≤—ã–ø–ª–∞—Ç—ã:</strong> {{ payroll.paid_at|date:"d.m.Y H:i" }}</p>
            {% endif %}
        </div>
    </div>

    <!-- –†–∞—Å—á—ë—Ç -->
    <div class="info-card">
        <div class="info-card-header green">
            <h3 style="margin: 0;">üí∞ –†–∞—Å—á—ë—Ç</h3>
        </div>
        <div class="info-card-body">
            <table style="width: 100%;">
                <tr>
                    <td>‚è±Ô∏è –í—Å–µ–≥–æ —á–∞—Å–æ–≤</td>
                    <td style="text-align: right;"><strong>{{ payroll.total_hours|floatformat:1 }}—á</strong></td>
                </tr>
                {% if payroll.overtime_hours > 0 %}
                <tr>
                    <td>üî• –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</td>
                    <td style="text-align: right;">{{ payroll.overtime_hours|floatformat:1 }}—á</td>
                </tr>
                {% endif %}
                <tr style="border-top: 1px solid #eee;">
                    <td>üí∞ –ë–∞–∑–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞</td>
                    <td style="text-align: right;">{{ payroll.base_salary|floatformat:0 }} ‚ÇΩ</td>
                </tr>
                {% if payroll.overtime_pay > 0 %}
                <tr>
                    <td>üî• –ó–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫—É</td>
                    <td style="text-align: right;">{{ payroll.overtime_pay|floatformat:0 }} ‚ÇΩ</td>
                </tr>
                {% endif %}
                {% if payroll.bonus > 0 %}
                <tr>
                    <td>üéÅ –ü—Ä–µ–º–∏—è</td>
                    <td style="text-align: right;">{{ payroll.bonus|floatformat:0 }} ‚ÇΩ</td>
                </tr>
                {% endif %}
                <tr style="border-top: 2px solid #eee;">
                    <td><strong>üìä –ù–∞—á–∏—Å–ª–µ–Ω–æ</strong></td>
                    <td style="text-align: right;"><strong>{{ payroll.gross_salary|floatformat:0 }} ‚ÇΩ</strong></td>
                </tr>
                <tr style="color: #e74c3c;">
                    <td>üìâ –ù–î–§–õ (13%)</td>
                    <td style="text-align: right;">-{{ payroll.ndfl_tax|floatformat:0 }} ‚ÇΩ</td>
                </tr>
                <tr style="background: #e8f5e9; font-size: 1.2rem;">
                    <td><strong>üíµ –ö –≤—ã–ø–ª–∞—Ç–µ</strong></td>
                    <td style="text-align: right;"><strong>{{ payroll.net_salary|floatformat:0 }} ‚ÇΩ</strong></td>
                </tr>
            </table>
        </div>
    </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ -->
<div class="buttons-center" style="margin-top: 25px;">
    {% if payroll.status != 'paid' and user.role == 'admin' %}
    <form method="post" action="{% url 'payroll_mark_paid' payroll.pk %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">üí≥ –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã–ø–ª–∞—á–µ–Ω–æ</button>
    </form>
    {% endif %}
    {% if user.role == 'admin' %}
    <a href="{% url 'payroll_delete' payroll.pk %}" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
    {% endif %}
    <a href="{% url 'payroll_list' %}" class="btn btn-secondary">‚Üê –ö —Å–ø–∏—Å–∫—É</a>
</div>
{% endblock %}