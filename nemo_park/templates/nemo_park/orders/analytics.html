{% extends 'nemo_park/base.html' %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞{% endblock %}

{% block content %}

<style>
  .a-card { background: #fff; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
  .a-card-head { padding: 20px; color: #fff; }
  .a-card-body { padding: 20px; }

  .a-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #eee;
    gap: 12px;
  }
  .a-row:last-child { border-bottom: none; }

  .a-date { color: #333; }
  .a-badge { color: #fff; padding: 3px 10px; border-radius: 15px; font-size: .9rem; }
  .a-money { color: #00b894; font-weight: 800; }
  .a-muted { color: #888; }
</style>

<div class="page-header">
    <div class="page-title">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</div>
</div>

<p style="color: #666; margin-bottom: 25px;">
    –ü–µ—Ä–∏–æ–¥: {{ start_date|date:"d.m.Y" }} ‚Äî {{ end_date|date:"d.m.Y" }} (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
</p>

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">üõí</div>
        <div class="stat-number">{{ total_orders.count|default:0 }}</div>
        <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤</div>
    </div>
    <div class="stat-card orange">
        <div class="stat-icon">üçï</div>
        <div class="stat-number">{{ total_orders.revenue|floatformat:0|default:0 }} ‚ÇΩ</div>
        <div class="stat-label">–í—ã—Ä—É—á–∫–∞ –∑–∞–∫–∞–∑–æ–≤</div>
    </div>
    <div class="stat-card purple">
        <div class="stat-icon">üé´</div>
        <div class="stat-number">{{ total_tickets.count|default:0 }}</div>
        <div class="stat-label">–ë–∏–ª–µ—Ç–æ–≤</div>
    </div>
    <div class="stat-card green">
        <div class="stat-icon">üíµ</div>
        <div class="stat-number">{{ total_tickets.revenue|floatformat:0|default:0 }} ‚ÇΩ</div>
        <div class="stat-label">–í—ã—Ä—É—á–∫–∞ –±–∏–ª–µ—Ç–æ–≤</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-top: 30px;">
    
    <!-- –ó–∞–∫–∞–∑—ã –ø–æ –¥–Ω—è–º -->
    <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
        <div style="background: linear-gradient(135deg, #0077B6 0%, #023E8A 100%); padding: 20px;">
            <h3 style="margin: 0; color: white;">üõí –ó–∞–∫–∞–∑—ã –ø–æ –¥–Ω—è–º</h3>
        </div>
        <div style="padding: 20px; max-height: 400px; overflow-y: auto;">
            {% for day in orders_by_day reversed %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee;">
                <span style="color: #333;">{{ day.day|date:"d.m.Y" }}</span>
                <span style="background: #0077B6; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.9rem;">
                    {{ day.count }} —à—Ç.
                </span>
                <strong style="color: #00b894;">{{ day.revenue|floatformat:0 }} ‚ÇΩ</strong>
            </div>
            {% empty %}
            <div style="text-align: center; color: #999; padding: 30px;">
                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- –ë–∏–ª–µ—Ç—ã –ø–æ –¥–Ω—è–º -->
    <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
        <div style="background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); padding: 20px;">
            <h3 style="margin: 0; color: white;">üé´ –ë–∏–ª–µ—Ç—ã –ø–æ –¥–Ω—è–º</h3>
        </div>
        <div style="padding: 20px; max-height: 400px; overflow-y: auto;">
            {% for day in tickets_by_day reversed %}
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee;">
                <span style="color: #333;">{{ day.day|date:"d.m.Y" }}</span>
                <span style="background: #6c5ce7; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.9rem;">
                    {{ day.count }} —à—Ç.
                </span>
                <strong style="color: #00b894;">{{ day.revenue|floatformat:0 }} ‚ÇΩ</strong>
            </div>
            {% empty %}
            <div style="text-align: center; color: #999; padding: 30px;">
                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-top: 25px;">
    
   <div class="a-card">
  <div class="a-card-head" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">
    <h3 style="margin:0;">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h3>
  </div>

  <div class="a-card-body">
    {% for product in popular_products %}
      <div class="a-row">
        <div style="color:#333;">{{ product.product__image_emoji }} {{ product.product__name }}</div>
        <div class="a-muted">{{ product.total_qty }} —à—Ç.</div>
        <div class="a-money">{{ product.total_revenue|floatformat:0 }} ‚ÇΩ</div>
      </div>
    {% empty %}
      <div style="text-align:center; color:#999; padding:30px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
    {% endfor %}
  </div>
</div>
    
   {% if top_cashiers %}
<div class="a-card">
  <div class="a-card-head" style="background: linear-gradient(135deg, #FF6B35 0%, #f7931e 100%);">
    <h3 style="margin:0;">üèÜ –õ—É—á—à–∏–µ –∫–∞—Å—Å–∏—Ä—ã</h3>
  </div>

  <div class="a-card-body">
    {% for cashier in top_cashiers %}
      <div class="a-row">
        <div>
          <strong style="color:#333;">
            {{ cashier.cashier__employee_profile__first_name }} {{ cashier.cashier__employee_profile__last_name }}
          </strong><br>
          <small class="a-muted">@{{ cashier.cashier__username }}</small>
        </div>

        <span class="a-badge" style="background:#f39c12;">
          {{ cashier.orders_count }}
        </span>

        <div class="a-money">{{ cashier.revenue|floatformat:0 }} ‚ÇΩ</div>
      </div>
    {% endfor %}
  </div>
</div>
{% endif %}
</div>

<!-- –ö–Ω–æ–ø–∫–∏ -->
<div class="buttons-center" style="margin-top: 30px;">
    <a href="{% url 'orders' %}" class="btn btn-secondary">‚Üê –ö –∑–∞–∫–∞–∑–∞–º</a>
    <a href="{% url 'dashboard' %}" class="btn btn-primary">üìä –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>
{% endblock %}