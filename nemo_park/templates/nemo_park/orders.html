{% extends 'nemo_park/base.html' %}

{% block title %}–ó–∞–∫–∞–∑—ã{% endblock %}

{% block content %}
<div class="page-header">
    <h2 class="page-title">üõí –ó–∞–∫–∞–∑—ã</h2>
    <a href="{% url 'create_order' %}" class="btn btn-success">
        ‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑
    </a>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="mini-stats">
    <div class="mini-stat">
        <span class="mini-stat-icon">üõí</span>
        <span class="mini-stat-number">{{ total_orders }}</span>
        <span class="mini-stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</span>
    </div>
    <div class="mini-stat pending">
        <span class="mini-stat-icon">‚è≥</span>
        <span class="mini-stat-number">{{ pending_orders }}</span>
        <span class="mini-stat-label">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</span>
    </div>
    <div class="mini-stat revenue">
        <span class="mini-stat-icon">üí∞</span>
        <span class="mini-stat-number">{{ total_revenue }} ‚ÇΩ</span>
        <span class="mini-stat-label">–í—ã—Ä—É—á–∫–∞</span>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ -->
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>‚Ññ</th>
                <th>üë§ –ü–æ—Å–µ—Ç–∏—Ç–µ–ª—å</th>
                <th>üçï –¢–æ–≤–∞—Ä—ã</th>
                <th>üí∞ –°—É–º–º–∞</th>
                <th>üìä –°—Ç–∞—Ç—É—Å</th>
                <th>üí≥ –ö–∞—Å—Å–∏—Ä</th>
                <th>üìÖ –î–∞—Ç–∞</th>
                <th>‚öôÔ∏è</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td><strong>#{{ order.id }}</strong></td>
                <td>
                    {% if order.visitor %}
                        {{ order.visitor.first_name }} {{ order.visitor.last_name }}
                    {% else %}
                        <span class="text-muted">–ë–µ–∑ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è</span>
                    {% endif %}
                </td>
                <td>
                    <span class="items-count">{{ order.orderitem_set.count }} —à—Ç.</span>
                </td>
                <td>
                    <span class="price">{{ order.total_price }} ‚ÇΩ</span>
                </td>
                <td>
                    <span class="status-badge status-{{ order.status }}">
                        {% if order.status == 'pending' %}‚è≥ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        {% elif order.status == 'preparing' %}üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∏—Ç—Å—è
                        {% elif order.status == 'ready' %}‚úÖ –ì–æ—Ç–æ–≤
                        {% elif order.status == 'delivered' %}üì¶ –í—ã–¥–∞–Ω
                        {% elif order.status == 'cancelled' %}‚ùå –û—Ç–º–µ–Ω—ë–Ω
                        {% endif %}
                    </span>
                </td>
                <td>{{ order.cashier.username }}</td>
                <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
                <td>
                    <div class="actions">
                        <a href="{% url 'order_detail' order.id %}" class="action-btn view-btn" title="–ü–æ–¥—Ä–æ–±–Ω–µ–µ">üëÅÔ∏è</a>
                        {% if user.role == 'admin' %}
                        <a href="{% url 'delete_order' order.id %}" class="action-btn delete-btn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8">
                    <div class="empty-state">
                        <div class="empty-icon">üõí</div>
                        <h3>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑</p>
                        <a href="{% url 'create_order' %}" class="btn btn-success">‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
    
    .mini-stats { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
    .mini-stat { background: #f8fafc; padding: 18px 28px; border-radius: 16px; text-align: center; border: 2px solid #e8e8e8; display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .mini-stat.pending { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); border: none; color: white; }
    .mini-stat.revenue { background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); border: none; color: white; }
    .mini-stat-icon { font-size: 1.8rem; }
    .mini-stat-number { font-size: 1.8rem; font-weight: 800; }
    .mini-stat-label { font-size: 0.85rem; opacity: 0.9; }
    
    .items-count { background: #f0f7ff; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; color: #0077B6; font-weight: 600; }
    .price { font-weight: 800; color: #00b894; font-size: 1.1rem; }
    .text-muted { color: #999; }
    
    .status-badge { padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: inline-block; }
    .status-pending { background: #fff3cd; color: #856404; }
    .status-preparing { background: #cce5ff; color: #004085; }
    .status-ready { background: #d4edda; color: #155724; }
    .status-delivered { background: #e8f8f5; color: #00b894; }
    .status-cancelled { background: #f8d7da; color: #721c24; }
    
    .actions { display: flex; gap: 8px; }
    .action-btn { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 1rem; transition: all 0.2s ease; }
    .action-btn.view-btn { background: #f0f7ff; }
    .action-btn.view-btn:hover { background: #0077B6; transform: scale(1.1); }
    .action-btn.delete-btn { background: #fff5f5; }
    .action-btn.delete-btn:hover { background: #e74c3c; transform: scale(1.1); }
    
    .empty-state { text-align: center; padding: 60px 20px; }
    .empty-icon { font-size: 4rem; margin-bottom: 15px; }
    .empty-state h3 { color: #333; margin-bottom: 10px; }
    .empty-state p { color: #666; margin-bottom: 20px; }
</style>
{% endblock %}